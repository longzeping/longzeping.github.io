---
layout:     post
title:      互联网主机入门
subtitle:   手把手教你打造自己的互联网主机——入门
date:       2018-08-29
author:     LZP
header-img: img/bg-it1.jpg
catalog: true
tags:
    - 端口映射
    - 互联网主机
---

> * 每个开发者都希望有一台自己的互联网主机，一是为了开发方便，可以方便测试各种网络技术、各种应用和各种服务。二是为了玩，对于真正喜欢IT技术的人来说，IT技术就是一个玩具、一个游戏，工作只是衍生物。三是为了方便、美化自己的生活。
> * 但是，互联网主机太贵，一只好母鸡（独立主机），总是太贵，公司购买的互联网主机，都是有专门用途的，容不得在上面随便捣腾。而各种小鸡（VPS——虚拟专用服务主机），受到网速、空间、运行速度的各种限制，很多服务都装不了。
> * 自己动手，打造一台互联网主机，想装什么就装什么，想部署什么服务就部署什么服务，当然是IT玩者的最爱之一。随着现在带宽越来越宽，100M光纤都已经到户，下载速度真百兆，上传速度一般也有8M，把自己的家用电脑或者笔记本，打造成一台互联网主机，硬条件已完全可行。

## 互联网主机能做什么？
> 理论上，现在互联网上有的各种服务和应用，都可以自己部署。随便列一些：云存储（网盘）、云数据库、视频点播、媒体中心、博客、网站，不仅仅可以自己用，还可以和互联网上的服务一样，供好友、家人注册、开通服务。笼统点说，IaaS、PaaS、SaaS的事，都可以自己做。

## 如何做互联网主机？
> 很简单，如果直接专线或者光猫拨号上网，有自己的公网IP，就是互联网上的主机了。如果有固定公网IP，更方便，没有，也没关系，DDNS（Dynamic Domain Name Server——动态域名服务，DDNS将动态IP地址映射到一个固定的域名解析服务上）可以解决问题。

## 端口是啥？
> 如果把计算机比喻成一套房子——你的家，公网IP就是你的家庭地址，通过这个地址，互联网上的人都能找到你的家。端口就是你家的入户门，城里房子小，很多就一个入户门，农村的房子，或者大别墅，就不一样了，有很多入户门，正门、侧面、后门、偏门、等等。互联网上你的家，是个超级大别墅，6万多个门（2的16次方——65536个）。

## 端口映射是啥？
> 如果没有局域网，不经过路由器上网，根本不需要这个端口映射。直接IP地址加端口，就是你的家的某个门。但现实情况是，现在大家都有了局域网，每家都是。现在上网，台式机、笔记本、手机、平板、智能电视、智能音箱、智能家电、等等，都在一个局域网里（大都是一个Wifi无线局域网），都通过路由器上网。拨号上网是由路由器自动完成的，IP地址也是分给这个路由器的，局域网就是一个家了。端口映射，就是路由器做的事，把访问（IP地址加某端口号），转到局域网内的某台电脑或者某个智能设备上的某个端口上（这个端口号和前面的端口号可以不一样），如果刚好这台电脑或者这个智能设备上，装有某个软件在监听这个端口，并通过这个端口传输数据提供某种服务，这个服务就是某种互联网服务了。

## 不映射可不可以？
> 可以！前面说过，没有局域网、路由器，根本不需要这个端口映射。现在有了，也可以做到，通过DMZ，DMZ是英文“demilitarized zone”的缩写，中文名称为“隔离区”，互联网和你的局域网之间的空间被称为DMZ，说白了，就是虚拟出来的这么一个区域，谁虚拟出来的？路由器！DMS就是路由器提供的一个功能————虽然某台电脑或者某个智能设备是连在局域网里面，但互联网对它的访问，就直接访问吧。和上面比较起来，还是上面的端口映射更灵活和方便一些，尤其是现在的路由器都是智能的，不需要到路由器上做端口映射，某台电脑或者某个智能设备上，要提供某种服务的某个软件，直接内置此功能————使用通用API，直接完成端口映射。当然，如果是老式路由器，还是需要登录路由器的管理软件，去完成端口映射的设置工作。

## 端口映射的新问题
> 很可能，并且是很高概率是这样————完成了端口映射，或者DMS设置，可还是无法通过互联网访问某台计算机提供的某种互联网服务。原因主要有两种，设置错误的，不在此讨论。
>> * 原因一：要用的这个端口被宽带服务商屏蔽了，原因大家都懂，这是政策原因，换个端口就可以了，一般常用的80、8000、8080、21都会被屏蔽。
>> * 原因二：你被内网了，你以为通过光猫拨号，进入了互联网，其实你进的只是服务商的内网，你分配到的只是一个内网IP。这个容易知道，但实践中容易忽略，很可能浪费数小时甚至数天的时间去找问题，以为是软件的问题。解决方法很简单，给你的宽带服务商打个电话，告诉他，你需要公网IP，要安装监控，即可。如果客服不懂，告诉她转给技术人员即可。很快就可以解决，譬如电信光纤，电话当场解决。默认不给公网IP，并非宽带服务商小气、想节约成本之类的原因，核心原因是因为IP地址是4位的，数量有限，IPv6就没这问题了，所以需要宽带服务商多此一举————NAT，网络地址转换。

## 举例：家庭媒体中心

> 如果，我们在家里的局域网内，部署了家庭媒体中心，通过这个媒体中心，我们可以看电影电视剧、看照片、听歌，资源共享，权限控制，都可以做到。譬如，在一台电脑上安装一个Serviio软件，就部署了家庭媒体中心。我们可以把要看的电影、电视剧、照片、音乐统统放到这台电脑上，局域网内的其它电脑、笔记本、手机、平板、智能电视、智能音箱、等等，都可以播放这些媒体。
> 如果，我们想在外出的时候，也能够访问这些媒体资源，怎么？
> 方法就是上面的做法，端口映射，譬如，我用的serviio软件和乐视路由器，只需要在Serviio软件中，开启远程访问，选中“自动配置路由器以允许连入的互联网连接”，并填入公网IP地址即可。
> 外出时，使用浏览器访问：http://IP地址:23424/mediabrowser就可以访问到家里的媒体中心了————看视频、照片、听歌，都可以。
>> * 注意1，23424是serviio的默认端口号。
>> * 注意2，每一次光猫重新拨号，获得的IP地址是不同的，为了能够固定访问到家里的媒体中心，可以申请一个免费的二级域名，解析到这个每次拨号都变的IP地址上。具体的简单方法：就是在提供媒体服务的计算机上装一个提供DDNS的工具，譬如花生壳，每次公网IP变化时，它会自动把新的IP地址提交过去，和你申请的固定二级域名绑定。
>>
> 到此，一个全环境的家庭媒体中心就OK了。同理，一个全环境的家庭文件中心或者云存储或者私有云，也可以依此部署。

## 如何使用域名访问？
### 通过DDNS把动态IP和二级域名绑定
> 家庭宽带，每次断网重新连接后，IP地址都是不一样的，通过IP访问就很不方便。所以，需要通过DDNS（动态域名服务），在每次断网重新连接后，都把新的IP地址和一个域名绑定起来。花生壳、3322都提供DDNS服务，然后和路由器的DDNS设置结合起来，就可以通过域名访问了。
> 譬如作者，就申请了一个花生壳的免费二级域名，每次通过http://我申请的名字.51vip.biz:23424/mediabrowser访问我家庭的媒体服务中心。但是，如此长的URL地址，输入起来的确不方便，下面有一个更好的方式。备注：“我申请的名字”因安全问题，在此省略了。

### 域名解析的URL转发
> * 第一步，到域名申请网站上（阿里云、腾讯云、百度云、等等），买一个自己喜欢的域名。很便宜，有些类型的域名每年只要十几块人民币，刚注册更有优惠，只要几块钱。
> * 第二步，域名备案（国内绝多数服务商都需要你先备案域名后，才提供域名解析，要备案，又必须先买主机，拐着弯让你花钱，但是，在国外注册的域名不需要备案，可直接解析）。
> * 第三步，域名解析，域名注册服务商都会提供域名解析服务，在域名管理的后台中，会有域名解析服务，添加一条显性URL或者隐形URL就可以了。譬如作者：添加了一个记录类型为“隐形URL”，主机记录为“m"，记录值为“http://我申请的名字.51vip.biz:23424/mediabrowser”的记录。这样，以后只要访问http://m.我申请的域名，就可以访问我家里的媒体主机了。备注：“我申请的名字”和“我申请的域名”，因安全问题，在此省略了。通过这种方式，大家也可以给自己喜欢的各种网站或者Web应用重命名，譬如用：http://z.我的域名，访问新浪网的某个栏目，http://stock.我的域名，访问雪球网的个人栏目。