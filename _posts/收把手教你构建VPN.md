---
layout:     post
title:      收把手教你构建VPN
subtitle:   VPN使用基础教程
date:       2018-09-06
author:     LZP
header-img: img/bg-it2.jpg
catalog: true
tags:
    - VPN
    - openVPN
---

### 用途

1.家里有一个小型的wifi网络，通过光猫拨号或者其它方式连接到互联网上。出门在外，想用笔记本电脑（Win7、win10、MacOS、Linux）或者手机（androidh、win10、iOS）或者平板电脑（Android、Win10、iOS、Linux），访问家庭网络里的各个电脑上的网络文件共享，或者访问家庭网络里的UPNP/DLNA服务，或者其它服务（ftp、http、webDAV）。

2.如何让家里的每一台上网设备，都能够越过伟大的长城，访问到google、facebook等服务。

3.公司里有办公网络，通过光猫或者专线等连接到互联网上。出门在外，要运行内部的ERP、或者访问内部的其它服务（文件共享、ftp、http、UPNP/DLNA媒体服务、数据库服务、版本控制系统、文档控制系统、私有云、及其它内部信息系统）。

4.公司有多处办公地点，每处都有自己的办公网络，都各自通过相同或不相同的方式，连接到互联网上。如何让这多处办公地点的网络互联互通，数据和服务，在每一处都可以使用，并受分级权限控制。

5.如何让合作伙伴连接到公司网络，访问特定服务。如何让分布在世界各处的分支机构连接到公司的网络，并按权限存取数据和服务。

### 方案
> 解决方案：
>> 方案一：纯软件解决方案（最少软件）
>>> * 第一步，远程唤醒/自动开机。需要共享信息和服务的某台或者某些电脑，开启远程网络唤醒（需要网卡支持，有些无线网卡不支持远程唤醒），或者开启加电自启（需可远控的智能插座支持）。一直开着则无需这一步。
>>> * 第二步，启用VPN服务。在被唤醒的电脑上（或者加电自启的电脑上），以Windows电脑为例，在控制面板\网络和Internet\网络连接中，新建传入的连接，允许通过internet建立VPN连接。
>>> * 第三步，启用端口转发。在wifi路由器上，启用端口转发，把对1723端口（windows VPN服务默认端口）的访问，转发到上面电脑的1723端口上。某些智能路由器，不支持设置端口转发，可以在上面电脑上安装一个路由器UPNP端口设置工具，添加1723端口转发。有些路由器可以存储这些信息，有些不能，对于这些不能记忆这些信息的，为了防止路由器重启后就没了端口转发设置，可以把上面电脑上的路由器UPNP端口设置工具设置为开机自启动，完成自动添加。
>>> * 第四步，外出设备上新建VPN连接。Windows的VPN是PPTP，一般手机、笔记本电脑、平板电脑，都支持新建这类VPN连接，无需安装客户端软件。此时，需要填入WiFi连接到internet上的公网IP，还有在上面电脑上设置VPN时指定的用户名和密码。如果公网IP每次都是变化的，则需要申请一个固定的域名。具体来说，就是在提供DDNS服务的网站上申请一个域名，如果wifi路由器支持DDNS，每次如有重新连接，会自动把IP更新到提供DDNS服务的网站，完成绑定。如果路由器不支持DDNS，则需要在上面电脑上安装DDNS服务商提供的客户端，并设为开机自启，完成新IP地址和域名的绑定。当然，如果上面这台电脑还需要远程唤醒，就陷入了死循环，唤醒需要IP，而这台电脑还没有启动，所以不能更新IP地址到DDNS服务商，通过域名访问到的是以前的老IP，无法唤醒上面的电脑。如果遇到这种情况，只能通过智能插座的方案解决。
>>> * 最后，外出设备先连到互联网，再通过VPN建立到内部网络的连接。就可以访问局域网了。当然，至于是否可以访问整个局域网，或者只是提供VPN服务的电脑，可以在VPN服务中设置。
>>> * 备注说明：非服务器版本的windows，一次只允许一个用户的接入，如果需要多个用户的同时接入，需要windows服务器版的支持。
>>> * 总结：此种方案，软硬件环境变动少，花费最少。
>>>
>> 方案二：软硬结合方案————提供DDNS服务和VPN服务的路由器
>>> * 第一步：升级到提供DDNS服务和VPN服务的路由器。只需要在路由器上设置好DDNS和VPN。
>>> * 第二步：外出设备上新建VPN连接。就可以通过VPN建立到家庭WiFi网络的连接。
>>> * 本方案和方案一的区别：方案一的DDNS和VPN，都在家庭WiFi网络里的电脑上完成。方案二由路由器全部完成，所以更简单。唤醒局域网的计算机也更方便了。
>>> * 总结：此种方案，花费不多，却很简单实用，是家庭和小公司首选。
>>>
>> 方案三：软硬结合方案————支持DDNS服务和VPN服务的NAS
>>> * 本方案和方案二类似，只是，DDNS服务和VPN服务后移到NAS上完成。由于NAS是不间断运行的。数据共享和各种应用服务，都可以由NAS来提供。
>>> * 总结：此种方案，是方案二的增强版，若需要大数据存储和服务，是首选。
>>>
>> 方案四：纯软件方案————专业软件自部署
>>> * 方案核心：把上面提供VPN服务的软件，替换成openVPN，Tcpcrypt，Openswan，Tinc，SoftEther VPN，OpenConnect，Libreswan，StrongSwan等软件。
>>> * 总结：对于有专业网管的公司，可以使用上面的openVPN，实现可伸缩的强大的VPN。
>>>
>> 方案五：纯软件方案————云服务
>>> * 方案核心：VPN服务由云服务提供。各客户端（可以是局域网路由器，也是某个或某些局域网中的某些计算机，也可以是多台单独的电脑或者手机或者其它设备），只要通过安装的客户端软件连接到VPN云服务上，就自动组成一个虚拟专用网。这些设备可以互相访问、共享数据和服务。
>>> * 目前，几个主流云服务商，都提供VPN服务。譬如，亚马逊就有openVPN云服务。当然，也可以在云服务商购买VPS，自己部署VPN服务，这个比自购VPN云服务麻烦一点。
>>> * 总结：未来组建VPN的发展趋势，方便、简单、可伸缩、可扩展。
>>>


### 关于上面这八款软件的介绍

 1. OpenVPN

OpenVPN是网络隐私世界的重要玩家之一。它是一种开源VPN技术，支持256-AES-CBC以及Windows下的2048位Diffie-Hellman密钥。对于Linux、iOS和MacOS用户，OpenVPN通过IKEv2/IPsec协议以AES-256-CGM和3072位 DH密钥加密信息。

在我的经验中，Diffie-Hellman密钥比RSA(Rivest、Shamir和Adelman)更稳健，因为它能够实现完美的前向保密，这确保了即使在长期密钥受到损害的情况下，过去的通信和传送也不能在将来被解密。

这意味着OpenVPN是最安全的开源VPN软件选项之一。

此外，OpenVPN的开发者社区也是网络安全领域最活跃和最有声望的社区之一。会员们不断完善和更新软件，以确保跟上日新月异的互联网安全格局。

考虑到其令人印象深刻的安全规范以及该软件背后充满激情的团队，我鼓励公司随时随地使用基于OpenVPN的安全解决方案，包括此列表中的部分选项。

2. openswan
（Linux）

Openswan是Linux的IPsec实现，支持大多数与IPsec相关的扩展(包括IKEv2)。从2005年初开始，它就被广泛地认为是Linux用户的首选VPN软件。根据您正在运行的Linux版本的不同，Openswan可能已经在您的发行版中，您也可以直接从它的站点下载源代码

3. Tcpcrypt
（Windows和MacOS）

Tcpcrypt协议是一种独特的VPN解决方案，它不需要配置或对应用程序进行更改，也不需要在网络连接中进行过多的设置。Tcpcrypt使用一种称为“机会式加密”的操作方式。这意味着如果连接的另一端支持与Tcpcrypt通信，通信将被加密，否则，它可以被视为明文。

虽然这不够完美，但该协议已经经历了许多强大的更新，使其更好地抵御被动和主动攻击。尽管我不建议将Tpcrypt作为全公司范围的解决方案，但对于处理不那么敏感信息的员工和分支机构来说，它可以作为一个极好的、易于实现的解决方案。

4. Tinc
（Linux，MacOS和Windows）

Tinc是使用GNU通用公共许可证授权的自由软件。Tinc与列表中的其他VPNs(包括OpenVPN协议)的区别在于它包含了各种独特特性，包括加密、可选压缩、自动网格路由和易于扩展。这些特性使得Tinc成为了那些想要在众多相隔甚远的小型网络中创建VPN的企业的理想解决方案。

5. SoftEther VPN
（Linux，Windows，MacOS等）

SoftEther(软件以太网的缩写)VPN是迄今为止市场上最强大和用户友好的多协议VPN软件之一。作为OpenVPN的理想替代品，SoftEther VPN为OpenVPN服务器提供了克隆功能，允许您无缝地从OpenVPN迁移到SoftEther VPN。 SoftEther令人印象深刻的安全标准和功能被认为可以与NordVPN等市场领先企业相媲美，使其成为开源巨头之一。

SoftEther还兼容L2TP和IPsec协议，支持用户定制。此外，SoftEther VPN还被证明比OpenVPN更快，拥有更好的浏览体验。SoftEther的主要缺点是它在兼容性方面落后于其他方案。然而，这个问题的主要原因是SoftEther协议的相对新颖性，并且随着时间的推移，您可能会看到越来越多的平台支持SoftEther。

6. OpenConnect
（Linux）

考虑到OpenConnect是为支持思科AnyConnect SSL VPN而创建的VPN客户端，您可能会惊讶于在列表中看到此软件(毕竟这是一篇详细介绍Cisco和Pulse替代品的文章)。但是，需要注意的是，OpenConnect与Cisco或Pulse Secure并没有正式的关联。它只是与他们的设备兼容。

事实上，在对思科客户进行测试之后，OpenConnect被发现存在大量安全漏洞，OpenConnect正着手整顿。如今，OpenConnect已经解决了所有的思科客户端缺陷，使它成为任何Linux用户的思科替代品之一。

7. Libreswan
（Linux，FreeBSD和MacOS）

经过15年的积极开发，Libreswan成为了现代市场上最好的开源VPN替代品之一。Libreswan目前支持最常见的VPN协议，IPsec、IKEv1和IKEv2。与Tcpcrypt一样，Libreswan基于机会加密进行操作，这使其容易受到主动攻击。然而，大量的安全功能和活跃的开发人员社区使Libreswan成为低中级加密要求的理想选择。

8. StrongSwan
（Linux，Android和路由器）

由通信安全教授、瑞士应用科学大学互联网技术与应用研究所所长Andreas Steffen负责维护的StrongSwan在VPN社区中独树一帜，它提供了卓越的加密标准和简单的配置，以及支持大型复杂VPN网络的IPsec策略。
