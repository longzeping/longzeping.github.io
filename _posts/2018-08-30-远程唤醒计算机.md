---
layout:     post
title:      远程唤醒计算机
subtitle:  手把手教你打造私有云————远程唤醒
date:       2018-08-30
author:     LZP
header-img: img/bg-it1.jpg
catalog: true
tags:
    - 远程唤醒
    - PIT
---


> 远程唤醒，是一项很古老的技术了，以前应用这项技术，是为了远程启动自己的计算机，以便远程控制自己的计算机，去获取数据，或者处理一些必须在该计算机上才能完成的工作。
> 现在，我们远程唤醒计算机，是为了获得该计算机提供的私有云服务。当然，如果不关机，就不用这么麻烦了，当然，这不够绿色环保，一台高性能台式机，每年至少700度电，一台笔记本，每年也要300度电。折算下来，也是几百银子。关键是，百分之九十以上的时候，都是白开着的。计算机既容易老化，也提高了被入侵的概率。
> 闲话少说，下面步入正题！

## 1.远程唤醒的原理
> 原理很简单：
>> 就是给需要唤醒的计算机的**有线网卡**，发送一个数据包。计算机就自动开机了，如果是睡眠状态，就自动唤醒。（注意，网卡一定是有线网卡，无线网址不支持的，如果没有插网线的计算机，不用往下看了）
>>
> 如何发数据包？
>> 知道计算机的地址（IP或者域名），找个发送网络数据的工具或者在线网页，填入地址，点击发送即可。数据包也无需自己写，工具自己就会准备好。
>>
> 知行合一是关键，开干！


## 2.需要的硬件基础

> 这是必不少的，缺少了，就不用往下看了。下面是清单：
>> 1. 一台用有线网卡连网的电脑。
>> 2. 电脑的BIOS中支持Wake on LAN（网络唤醒）
>>> * 重启电脑，进入BIOS，找到Wake On LAN，Enable即可。
>>> * 然后关机，检查Wake On LAN是否可用，如果关机后网卡指示灯和网线连到路由器上的端口指示灯是亮着的或者闪烁的，就表示正常。
>> 3. 一台具备如下功能的路由器。
>>> (1) 断网自动重拨联网功能（所有路由器都有这个功能），算废话了。
>>> (2) Mac地址绑定功能[ARP功能]（可以把你计算机Mac地址和IP地址绑定，确保每次分配给你的都是固定的内部IP地址）。
>>> (3) 动态域名服务[DDNS功能]。因为路由器拨号，每次得到的公网IP地址不一样，人在外，都不知道是哪个IP地址，不知道地址，也就无法唤醒。路由器提供的DDNS功能，本质就是每次连上网后，把自己的公网IP地址提交给在互联网上的DNS服务器，和自己申请的域名绑定在一起。
>>> (4) 虚拟服务器功能[其实就是一个端口转发功能]，让路由器收到数据包后，根据端口号转发给指定计算机的指定端口号。或者DMZ功能，就是创建在互联网和局域网之间的一个虚拟隔离区，换句话说，就是路由器收到外部数据包直接转发给DMZ的计算机。
>>>
>>> 说明：这几项功能，一般路由器都有。另外，要注意路由器的入站通信策略，如果把所有的入站通信都禁止了，就收不到外面发来的唤醒数据包。还有，有些路由器，本身自带唤醒电脑功能，只需在里面设置即可）。

### 3.如果路由器没有那些功能怎么办？
> 方法一：换一台路由器。
> 方法二：买一个向日葵开机棒。它会直接内网穿透，即便宽带服务商没有给你分配公网IP也没关系。但是，远程被开机的计算机还是要用网线连接到路由器，并做了BIOS的Wake On LAN设置。
> 方法三：参考下一章节。

### 4.如果上面的三个条件都不满足怎么办？

> 如果电脑没有通过网线连接路由器，或者没有Wake On LAN功能功能，或者路由器没有上面的几种功能支持，或者三种条件都不具备。
> 方法只有一个：
>> 主板启用通电开机功能，然后买入一个小米智能插座，通过网络，远程开启小米智能插座，通电后，电脑就自动启动了。如果电脑通电自启功能也没有，就不用折腾了，要远程控制，只能常开着了。
>>> * 小米智能插座内置嵌入式系统和服务软件，该软件具备内网穿透功能，它通过wifi接入内网，并通过路由器访问互联网，它和小米智能家居的服务端软件建立了UDP连接，我们通过小米智能家居的手机端软件，和服务端软件连接，就可以控制这个智能插座，打开智能插座即可让计算机加电自启动。
>>>
>>> * 还有些智能设备，并不建立连接，而是周期性的自动把路由器获得的公网IP发送到一个公网上的中心数据库，并利用智能路由器，自动启用路由器某端口到该设备某端口的映射。控制端软件，通过IP地址和端口号，去和智能设备上的服务软件通信，控制智能设备，这种方式，没有公网IP，是不行的，需要和宽带服务商联系要求公网IP。

### 5.实践步骤(互联网)
> 1. 设置电脑的Wake On LAN(在BIOS中开启，关机后通过网卡灯和路由器端口灯判断)
> 2. 路由器上设置Mac地址和内网IP的绑定（Mac地址是电脑有线网卡的地址，通过在本机运行cmd，然后执行ipconfig /all查看）
> 3. 路由器上设置端口转发（端口号随意，不和其它冲突就可以了）
> 4. 路由器上设置DDNS，还需要到网上注册服务（花生壳或者3322等）。
> 5. 通过数据包发送工具（软件irpm、http://www.depicus.com/wake-on-lan/woli.aspx在线提交唤醒包、等等），就可以远程开关机了。

### 6.实践步骤(局域网)
> 1. 设置电脑的Wake On LAN(在BIOS中开启，关机后通过网卡灯和路由器端口灯判断)
> 2. 通过数据包发送工具（软件irpm、PCnet Magic Packet Utility等类似工具），在本机就可以控制局域网所有其它机器的开关机了。
> 3. 备注说明：路由器上的那些设置就都可以免了，因为在一个局域网内，无需设置端口转发，也无需DDNS。

### 7.实践步骤(互联网——智能插座版)
> 1. 设置电脑通电自启(在BIOS中开启)
> 2. 安装小米智能插座（首先，电脑通过小米智能插座连接电源；然后，把智能插座连接到内部WIFI网络），并通过手机端管理软件控制智能插座，这样就可以在手机端控制电脑开关机了。
> 3. 在花生壳或者3322上注册账号，并申请一个二级域名。
> 4. 下载花生壳或者3322的客户端软件，设置成开机自启动（默认是开机自启动），自动登录。（客户端软件会在启动后，自动更新IP地址到花生壳或者3322的DDNS），路由器上的设置就可以免了。通过二级域名就可以访问到该计算机，通过远程控制软件可以控制这台计算机，在这台计算机上安装各种服务后，就可以通过二级域名访问各种服务了。

### 8.没有公网IP怎么办？
> 备注：如果没有公网IP
>>  1. 可以联系宽带服务商提供公网IP（譬如电信光纤宽带，打个10000电话就可以，告知安装远程监控需公网IP即可）
>>  2. 也可以下载3322的内网域名客户端（无需公网IP，但有2G的流量限制）
>>  3. 也可以申请花生壳的内网穿透直通车，6元体验价包含1M带宽和每月1G流量。
>> 上面三种方式，当然是第一种最好，后两种方式，通过花生壳或者3322数据中转，肯定速度不佳。流量少，带宽小，视频应用更是无法用。某些特殊环境下，可能搞不到公网IP，通过第2和第3种方式，远程开机处理一些应急事情还是可以的。

### 9.绑定一级域名
> 可以到阿里云、腾讯云或者百度云上，申请一个自己的域名，找个小工具或者自己写个小程序，把IP地址动态更新到阿里云或腾讯云或百度云的DNS上。这样，就可以通过一级域名访问自己的电脑了。